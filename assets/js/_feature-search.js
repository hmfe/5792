"use strict";define(["fetch","utilities","history"],function(e,t,r){var s="http://api.tvmaze.com/search/shows?q=",n=10,i=3,o="search",c={input:"search__input",inputPlaceholder:".search__input-placeholder",inputReset:".search__input-reset",results:".search__results",list:"search__results-list",listItem:"search__results-item",notice:".search__notice"};return{create:function(){this.bindSearchInputEvents();this.bindResetEvent();r.createSearchHistoryFeed()},search:function(){var r=this,n=this.getSearchedKey();if(!this.validateSearchedKey(n))return!1;this.removeResultList();t.createLoader(o,c.notice);e.fetchData(s+n).then(function(e){r.prepareResults(e)},function(r){t.destroyLoader(o);t.showErrorNotFound(e.getFetchError(r,1),o,c.notice)})},prepareResults:function(r){var s=e.getItems(r),i=e.getItemsCount(s,n),a=e.getFetchError(r,i);a?t.showErrorNotFound(a,o,c.notice):this.showResults(s,i);t.destroyLoader(o)},showResults:function(e,t){for(var r="",s=document.createElement("ul"),n=document.querySelector(c.results),i=0;i<t;i++)r+=this.formatResultItems(e[i]);s.insertAdjacentHTML("beforeend",r);s.classList.add(c.list);n.appendChild(s)},formatResultItems:function(e){return e?'<li class="'.concat(c.listItem,'">').concat(e.show.name,"</li>"):""},removeResultList:function(){document.querySelectorAll("."+c.list).forEach(function(e){e.remove()})},getSearchInput:function(){return document.getElementById(c.input)},getSearchedKey:function(){return this.getSearchInput()?this.getSearchInput().value:""},validateSearchedKey:function(e){return e&&e.length>=i&&/^[a-z0-9\s]+$/i.test(e)},bindSearchInputEvents:function(){this.getSearchInput().addEventListener("keyup",function(e){this.togglePlaceholder();this.processSearchInput(e)}.bind(this),!1)},processSearchInput:t.debounce(function(e){this.search();if(13==e.keyCode){var t=this.getSearchedKey();if(this.validateSearchedKey(t)){r.saveHistoryToStorage(t);r.addNewSearchToHistoryList(t)}}},250),bindResetEvent:function(){document.querySelector(c.inputReset).onclick=function(e){this.getSearchInput().value="";this.togglePlaceholder();this.removeResultList()}.bind(this)},togglePlaceholder:function(){var e=document.querySelector(c.inputPlaceholder);this.getSearchInput().value.length>0?e.style.display="none":e.style.display=""},errorGalleryUnprepared:function(e){t.showErrorNotFound(e);t.destroyLoader()}}});
"use strict";define(["fetch","utilities","history"],function(e,t,r){var s="http://api.tvmaze.com/search/shows?q=",n=10,i=3,c="search",o={input:"search__input",list:"search__results-list",listItem:"search__results-item",inputPlaceholder:".search__input-placeholder",inputReset:".search__btn-reset",results:".search__results",notice:".search__notice"};return{create:function(){this._bindSearchInputEvents();this._bindResetEvent();r.createSearchHistoryFeed()},search:function(){var r=this,n=this._getSearchedKey();if(!this._validateSearchedKey(n))return!1;this._removeResultList();t.removeErrorMessages(c);t.createLoader(c,o.notice);e.fetchData(s+n).then(function(e){r._prepareResults(e)},function(r){t.destroyLoader(c);t.showErrorNotFound(e.getFetchError(r,1),c,o.notice)})},_prepareResults:function(r){if(r){var s=e.getItems(r),i=e.getItemsCount(s,n),a=e.getFetchError(r,i);a?t.showErrorNotFound(a,c,o.notice):this._showResults(s,i);t.destroyLoader(c)}},_showResults:function(e,t){if(e||t){for(var r="",s=document.createElement("ul"),n=document.querySelector(o.results),i=0;i<t;i++)r+=this._formatResultItem(e[i]);s.insertAdjacentHTML("beforeend",r);s.classList.add(o.list);n.appendChild(s)}},_formatResultItem:function(e){return e?'<li class="'.concat(o.listItem,'">').concat(e.show.name,"</li>"):""},_removeResultList:function(){document.querySelectorAll("."+o.list).forEach(function(e){e.remove()})},_bindSearchInputEvents:function(){this._getSearchInput().addEventListener("keyup",function(e){this._togglePlaceholder();this._processSearchInput(e)}.bind(this),!1)},_processSearchInput:t.debounce(function(e){this.search();if(13==e.keyCode){var t=this._getSearchedKey();if(this._validateSearchedKey(t)){r.saveHistoryToStorage(t);r.addNewSearchToHistoryList(t)}}},250),_getSearchInput:function(){return document.getElementById(o.input)},_getSearchedKey:function(){return this._getSearchInput()?this._getSearchInput().value:""},_validateSearchedKey:function(e){return e&&e.length>=i&&/^[a-z0-9\s]+$/i.test(e)},_bindResetEvent:function(){document.querySelector(o.inputReset).onclick=function(e){this._getSearchInput().value="";this._togglePlaceholder();this._removeResultList()}.bind(this)},_togglePlaceholder:function(){var e=document.querySelector(o.inputPlaceholder);this._getSearchInput().value.length>0?e.style.display="none":e.style.display=""}}});